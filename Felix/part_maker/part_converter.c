/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   part_converter.c                                   :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: chatou <chatou@student.42.fr>              +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/04/21 20:02:10 by chatou            #+#    #+#             */
/*   Updated: 2025/04/21 22:01:28 by chatou           ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "part_converter.h"

// Correspondance entre noms de notes et fréquences
int get_frequency(const char* note)
{
    if (strcmp(note, "C3") == 0) return C3;
    if (strcmp(note, "c3") == 0) return c3;
    if (strcmp(note, "D3") == 0) return D3;
    if (strcmp(note, "d3") == 0) return d3;
    if (strcmp(note, "E3") == 0) return E3;
    if (strcmp(note, "F3") == 0) return F3;
    if (strcmp(note, "f3") == 0) return f3;
    if (strcmp(note, "G3") == 0) return G3;
    if (strcmp(note, "g3") == 0) return g3;
    if (strcmp(note, "A3") == 0) return A3;
    if (strcmp(note, "a3") == 0) return a3;
    if (strcmp(note, "B3") == 0) return B3;
    if (strcmp(note, "C4") == 0) return C4;
    if (strcmp(note, "c4") == 0) return c4;
    if (strcmp(note, "D4") == 0) return D4;
    if (strcmp(note, "d4") == 0) return d4;
    if (strcmp(note, "E4") == 0) return E4;
    if (strcmp(note, "F4") == 0) return F4;
    if (strcmp(note, "f4") == 0) return f4;
    if (strcmp(note, "G4") == 0) return G4;
    if (strcmp(note, "g4") == 0) return g4;
    if (strcmp(note, "A4") == 0) return A4;
    if (strcmp(note, "a4") == 0) return a4;
    if (strcmp(note, "B4") == 0) return B4;
    if (strcmp(note, "C5") == 0) return C5;
    if (strcmp(note, "c5") == 0) return c5;
    if (strcmp(note, "D5") == 0) return D5;
    if (strcmp(note, "d5") == 0) return d5;
    if (strcmp(note, "E5") == 0) return E5;
    if (strcmp(note, "F5") == 0) return F5;
    if (strcmp(note, "f5") == 0) return f5;
    if (strcmp(note, "G5") == 0) return G5;
    if (strcmp(note, "g5") == 0) return g5;
    if (strcmp(note, "A5") == 0) return A5;
    if (strcmp(note, "a5") == 0) return a5;
    if (strcmp(note, "B5") == 0) return B5;
    if (strcmp(note, "C6") == 0) return C6;
    if (strcmp(note, "N0") == 0) return N0;
    
    return 0;
}

void parse_partition_from_string(const char **data, t_part *p)
{
    int i = 0;

    while (data[i] != NULL)
    {
        char note[3] = { data[i][0], data[i][1], '\0' };
        int freq = get_frequency(note);
        
        int j = 4;
        int t = 0;
        while (data[i][j] != '\0')
        {
            // fprintf(stderr, "data[%d][%d] = %c and t is : %d\n", i, j, data[i][j], t + 1);
            if (t >= TEMPS_MAX)
            {
                // fprintf(stderr, "Erreur : Dépassement de TEMPS_MAX with %d\n", t);
                break;
            }

            if (data[i][j] == '|')
            {
                j++;
                continue;
            }
            else if (data[i][j] == 'X')
            {
                int count = 0;
                while (p->notes[t].freqs[count] != 0 && count < 4)
                {
                    count++;
                }

                if (count < NOTES_MAX)
                {
                    p->notes[t].freqs[count] = freq;
                    p->notes[t].count++; // Incrémente le nombre de fréquences non nulles
                }
                else
                {
                    fprintf(stderr, "Erreur : Dépassement de NOTES_MAX au temps %d\n", t);
                }
            }
            t++;
            j++;
        }
        i++;            
    }
}

void write_partition_to_file(t_part *p)
{
    FILE *file = fopen("partition.h", "w");
    if (file == NULL)
    {
        perror("Erreur d'ouverture du fichier");
        return;
    }

    fprintf(file, "\n#pragma once\n\n#include \"head.h\"\n\nconst t_part notes[TEMPS_MAX] = {\n");
    for (int i = 0; i < TEMPS_MAX; i++)
    {
        fprintf(file, "    {.freqs = {");
        for (int j = 0; j < 4; j++)
        {
            fprintf(file, "%d", p->notes[i].freqs[j]);
            if (j < 4 - 1)
                fprintf(file, ", ");
        }
        fprintf(file, "}, .count = %d},\n", p->notes[i].count);
    }
    fprintf(file, "};\n");
    fclose(file);

    printf("Fichier partition.c écrit avec succès.\n");
}

int main()
{
    
    const char *tetris_data[] = {
        "g2 |----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|",
        "A2 |----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|----|",
        "B2 |----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "C3 |----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|----|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "D3 |----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "E3 |-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "g3 |----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|",
        "A3 |----|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|",
        "B3 |----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "C4 |----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "D4 |----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "E4 |----|-XXX|X---|-XXX|X---|-XXX|X---|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "g4 |----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "A4 |----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "B4 |----|----|-XXX|----|----|----|----|-XXX|X---|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "C5 |----|----|----|-XXX|----|----|-XXX|X---|----|----|----|-XXX|X---|----|----|-XXX|X---|----|----|-XXX|X---|----|----|----|-XXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|----|----|----|-XXX|X---|----|----|-XXX|X---|----|----|----|-XXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|-XXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "D5 |----|----|----|----|-XXX|XXXX|X---|----|----|----|----|----|----|----|-XXX|X---|----|----|----|----|-XXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|----|----|----|----|-XXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "E5 |-XXX|XXXX|X---|----|----|----|----|----|----|----|----|----|-XXX|XXXX|X---|----|----|----|----|----|----|----|-XXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|-XXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|-XXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|",
        "F5 |----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|----|----|----|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "G5 |----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|",
        "g5 |----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|XXXX|XXXX|XXXX|XXXX|X---|",
        "A5 |----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|X---|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|-XXX|XXXX|XXXX|XXXX|X---|----|----|----|----|----|----|----|----|",
        NULL
        };
        //   1    5    9    13   17   21   25   29   33   37   41   45   49   53   57   61   65   69   73   77   81   85   89   93   97   101  105  109  113  117  121  125  129  133  137  141  145  149  153  157  161  165  169  173  177  181  185  189  193  197  201  205  209  213  217  221  225  229  233  237  241  245  249  253  257  261  265  269  273  277  281  285  289  293  297  301  305  309  313  317  321  325  329  333  337  341  345  349  353  357  361  365  369  373  377  381  385  389  393  397  401  405  409  413  417  421  425  429  433  437  441  445  449  453  457  461  465  469  473  477  481  485  489  493  497  501  505  509  513  517  521  525  529  533  537  541  545  549  553  557  561  565  569  573  577  581  585  589  593  597  601  605  609  613  617  621  625  629  633  637  641  645  649  653  657  661  665  669  673  677  681  685  689  693  697  701  705  709  713  717  721  725  729  733  737  741  745  749  753  757  761  765  769  773  777  781  785  789  793  795  799  803  807  811  815  819  823  827  831  835  839  843  847  851  855  859  863  867  871  875  879  883  887  891  895  899  903  907  911  915  919  923  927  931  935  939  943  947  951  955  959  963  967  971  975  979  983  987  991  995  999  1003 1007 1011 1015 1019 1023 1027 1031 1035 1039 1043 1047 1051 1055 1059 1063 1067 1071 1075 1079 1083 1087 1091 1095 1099

        

    t_part p = {0}; // Initialisation de la partition


    // Partition lue depuis la chaîne de caractères
    parse_partition_from_string(tetris_data, &p);

    fprintf(stderr, "Partition parsed successfully.\n");
    write_partition_to_file(&p); // Appel de la fonction qui creer un fichier .c avec le tableau

}